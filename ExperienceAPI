// This class is in charge of handling the interaction with the AR experience through the EmbedSDK.

class OxExperience {
    /**
     * Names of the elements in the AR experience.
     */
    LABEL_BOTTLES = "TAG3-Valor";
    MAIN_TEXT = "TAG2-Valor";
    MAIN_TEXT_2 = "TAG1-Valor";

    /**
     * Number of elements to show
     */
    numberOfBottles = 0;
    maintextone = 0;
    maintexttwo = 0;

    /**
     * Constructor
     * Initialize the embedSDK
     * 
     * @param   embedsdk allows you to listen to events and control the scene content
     */
    constructor(embedSDK) {
        this.embedSDK = embedSDK;
        this.data = {}; // Moved data initialization here for clarity
    }

    /**
     * Fetch data from the API and set numberOfBottles.
     */
    async getWeather() {
        const apiUrl = 'https://jsonplaceholder.typicode.com/todos/1';
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error('Network response was not ok');
            this.data = await response.json();
            this.numberOfBottles = this.data.id;
            this.maintextone = this.data.title;  // Set numberOfBottles directly from API response
            this.maintexttwo = this.data.completed; 
            this.updateLabels(); // Update labels after fetching data
        } catch (error) {
            console.error('Fetch error:', error);
        }
    }

    init() {
        this.getWeather(); // Fetch weather data on initialization
    }

    /**
     * Updates label text for all relevant UI elements.
     */
    updateLabels() {
        this.embedSDK.setLabelText(this.LABEL_BOTTLES, this.numberOfBottles.toString());
        this.embedSDK.setLabelText(this.MAIN_TEXT, this.maintextone.toString());
        this.embedSDK.setLabelText(this.MAIN_TEXT_2, this.maintexttwo.toString());
    }
}

/**
 * Onirix Embed SDK allows you to listen to events and control the scene when embedding experiences in a custom domain or from the online code editor.
 * For more information visit https://docs.onirix.com/onirix-sdk/embed-sdk
 */
import OnirixEmbedSDK from "https://unpkg.com/@onirix/embed-sdk@1.11.0/dist/ox-embed-sdk.esm.js";

const embedSDK = new OnirixEmbedSDK();
await embedSDK.connect();
const oxExperience = new OxExperience(embedSDK);

/**
 * It's executed when the scene is totally loaded and it starts the game.
 */
embedSDK.subscribe(OnirixEmbedSDK.Events.SCENE_LOAD_END, (params) => {
    oxExperience.init();
});
